function searchTransacoes(){$("#inSearchBtn").click((function(e){var search;atualizarTabela($("#inSearch").val()),$(".loadResult").hide()})),$("#inSearch").keypress((function(e){var search;($(".loadResult").hide(),13===e.which)&&atualizarTabela($("#inSearch").val())})),$("#pager").on("click","a",(function(e){$(".loadResult").hide(),e.preventDefault();var href=$(this).attr("href"),urlParams=new URLSearchParams(href),page=urlParams.get("page"),search=urlParams.get("search");console.log(page),isNaN(page)||atualizarTabela(search,page)}))}function atualizarTabela(search=!1,page=1){$("#tabela-dados").empty(),$("#cardResult").hide(),$(".loadResult").show();var url=`${_baseUrl}api/v1/transacoes/user/${globalIdLogin}?`;search&&(url+="search="+search+"&"),page&&(url+="page="+page),$.getJSON(url).done((function(data,textStatus,jqXHR){$("#valorPageView").html(data.currentPageTotal),$("#valorTotalView").html(data.allPagesTotal),$("#numResults").html(data.num),0===data.rows.length?($("#cardResult").hide(),$(".noresult").show()):($("#cardResult").show(),$(".noresult").hide()),$.each(data.rows,(function(index,row){var status;let btn;var desc;"Pago"==row.status?(status=`<span class="badge bg-success">${row.status}</span>`,btn=`<button class="btn btn-danger btn-sm" onclick="reembolsar('${row.id_transacao}', '${row.id}', '${row.valor}')">Reembolsar</button>`):"Cancelado"==row.status?(status=`<span class="badge bg-danger">${row.status}</span>`,btn=""):"Reembolsado"==row.status?(status=`<span class="badge bg-dark">${row.status}</span>`,btn=""):(status=`<span class="badge bg-warning">${row.status}</span>`,btn=`<button class="btn btn-info btn-sm" onclick="sincronizar('${row.id_transacao}')">Sincronizar</button>`),desc="oferta"===row.desc?'<span class="badge bg-primary">Oferta</span>':'<span class="badge bg-info">Dízimo</span>';var newRow=`\n                <tr>\n                    <td>${row.id}</td>\n                    <td>${row.descricao_lg}<br>${desc}</td>\n                    <td>${row.data_criado}</td>\n                    <td>${row.data_pag?row.data_pag:""}</td>\n                    <td>${row.valor}</td>\n                    <td>${status}</td>\n                    <td>${row.forma_pg}</td>\n                    <td>\n                        <div class="btn-group btn-group-sm">\n                            ${btn}\n                        </div>\n                    </td>\n                </tr>\n            `;$("#tabela-dados").append(newRow)})),$(".loadResult").hide(),$("#pager").html(data.pager)})).fail((function(jqXHR,textStatus,errorThrown){console.error("Erro ao carregar os dados:",textStatus,errorThrown)}))}function reembolsar(id,id_transacao,valor){$("#staticBackdrop").modal("show");var url=`${_baseUrl}api/v1/transacoes/user/reembolso/${id}?`;$("#formReembolso").attr("action",url),$("#id_transacao").val(id_transacao),$("#valor").val(valor),$(".formReembolso").ajaxForm({beforeSubmit:function(formData,jqForm,options){Swal.fire({text:"Solicitando reembolso...",icon:"info"})},success:function(responseText,statusText,xhr,$form){console.log(responseText.ReasonMessage),"Successful"===responseText.ReasonMessage?Swal.fire({text:"Reembolso realizado com sucesso...",icon:"success"}):Swal.fire({html:"Reembolso agendado, a qualquer momento ele poderá liberado.<br> Status: "+responseText.ReasonMessage,icon:"error"}),atualizarTabela()},error:function(xhr,status,error){console.log(xhr.responseJSON.messages.error),Swal.fire({text:"Erro ao tentar fazer o reembolso, se caso o erro persistir, entre com contato com suporte.",icon:"error"})}})}function sincronizar(id_transacao){Swal.fire({text:"Sincronizando...",icon:"info"}),$.getJSON(`${_baseUrl}api/v1/cielo/payment-status/${id_transacao}`,(function(data,textStatus,jqXHR){console.log(data.statusName),"Pending"===data.statusName?Swal.fire({html:"Transação sincronizada<br>status: Pendente",icon:"warning"}):"Authorized"===data.statusName?Swal.fire({html:"Transação sincronizada<br>status: Pago",icon:"success"}).then(()=>{atualizarTabela()}):"PaymentConfirmed"===data.statusName?Swal.fire({html:"Transação sincronizada<br>status: Pago",icon:"success"}).then(()=>{atualizarTabela()}):"Refunded"===data.statusName?Swal.fire({html:"Transação sincronizada<br>status: Reembolsado",icon:"info"}):Swal.fire({html:"Transação sincronizada<br>status: "+data.statusName,icon:"error"})}))}$(document).ready((function(){searchTransacoes(),$("#formReembolso").removeAttr("action")}));