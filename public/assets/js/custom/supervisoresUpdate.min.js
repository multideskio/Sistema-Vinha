let choicesRegioesInstance,choicesGerentesInstance;function initialize(){searchUpdate(_idSearch),formatInput(),setupEventHandlers()}function formatInput(){$(".cpf").mask("000.000.000-00"),$(".cep").mask("00000-000"),$(".telFixo").mask("(00) 0000-0000"),$(".celular").mask("+00 (00) 0 0000-0000")}function setupEventHandlers(){configureFileUploads(),configureAjaxForms()}function configureFileUploads(){$(".enviaLinks").on("change",()=>$(".formTexts").submit()),$("#profile-img-file-input").on("change",()=>$(".formUpload").submit())}function configureAjaxForms(){setupAjaxForm(".formTexts","PUT",handleFormTextsSuccess),setupAjaxForm(".formGeral","PUT",handleFormGeralSuccess),setupAjaxForm(".formUpload",null,handleFormUploadSuccess)}function setupAjaxForm(selector,method,successCallback){$(selector).ajaxForm({beforeSubmit:function(formData,jqForm,options){method&&(options.type=method),".formTexts"!=selector&&showLoadingMessage()},success:successCallback,error:handleFormError})}function showLoadingMessage(){Swal.fire({text:"Enviando dados!",icon:"info"})}function handleFormTextsSuccess(responseText,statusText,xhr,$form){showTemporaryAlert(".alertAlterado",1200)}function handleFormGeralSuccess(responseText,statusText,xhr,$form){Swal.fire({text:"Atualizado com sucesso!",icon:"success"}),searchUpdate(_idSearch)}function handleFormUploadSuccess(responseText,statusText,xhr,$form){Swal.fire({text:"Imagem atualizada com sucesso!",icon:"success"})}function handleFormError(xhr,status,error){Swal.fire({text:"Erro ao processar a solicitação",icon:"error"}),console.error(xhr,status,error)}function searchUpdate(id){if(!id)return void showErrorAndGoBack("Os dados não foram encontrados");const url=`${_baseUrl}api/v1/supervisores/${id}`;$.getJSON(url).done(handleSearchUpdateSuccess).fail(handleSearchUpdateError),$("#fotoPerfil").on("error",(function(){$(this).attr("src","https://placehold.co/50/00000/FFF?text=V")}))}function handleSearchUpdateSuccess(data){updateFormFields(data),atualizarTabela(),listRegioes(data.idRegiao),listGerentes(data.idGerente)}function handleSearchUpdateError(jqXHR,textStatus,errorThrown){$("#fotoPerfil").attr("src","https://placehold.co/50/00000/FFF?text=V"),console.error("Erro ao carregar os dados:",textStatus,errorThrown),showErrorAndGoBack("Os dados não foram encontrados")}function updateFormFields(data){$("#fotoPerfil").attr("src",data.foto||"https://placehold.co/50/00000/FFF?text=V"),$("#viewNameUser").text(data.nome),$("#facebook").val(data.facebook),$("#website").val(data.website),$("#instagram").val(data.instagram),$("#nome").val(data.nome),$("#sobrenome").val(data.sobrenome),$("#cpf").val(data.cpf),$("#cel").val(data.celular),$("#email").val(data.email),$("#tel").val(data.telefone),$("#cep").val(data.cep),$("#uf").val(data.uf),$("#cidade").val(data.cidade),$("#bairro").val(data.bairro),$("#complemento").val(data.complemento),$("#dizimo").val(data.data_dizimo),$("#gerente").val(data.gerente),$("#regiao").val(data.regiao),globalIdLogin=data.id_login}function listRegioes(idAtual){destroyChoicesInstance(choicesRegioesInstance),$("#selectRegiao").empty().removeAttr("required"),$.getJSON(`${_baseUrl}api/v1/regioes`).done(data=>{populateSelectOptions("#selectRegiao",data.rows,idAtual),choicesRegioesInstance=initializeChoices("#selectRegiao")}).fail(()=>showErrorAndGoBack("Cadastre regiões antes de cadastrar um supervisor..."))}function listGerentes(idAtual){destroyChoicesInstance(choicesGerentesInstance),$("#selectGerentes").empty().removeAttr("required"),$.getJSON(`${_baseUrl}api/v1/gerentes/list`).done(data=>{populateSelectOptions("#selectGerentes",data,idAtual),choicesGerentesInstance=initializeChoices("#selectGerentes")}).fail(()=>showErrorAndGoBack("Cadastre gerentes antes de cadastrar um supervisor..."))}function destroyChoicesInstance(instance){instance&&instance.destroy()}function initializeChoices(selector){return"undefined"!=typeof Choices?new Choices(selector,{allowHTML:!0}):null}function populateSelectOptions(selector,data,selectedId){const select=$(selector);data.forEach(item=>{const isSelected=selectedId===item.id?"selected":"";select.append(`<option ${isSelected} value="${item.id}">${item.id} - ${item.nome}</option>`)}),select.attr("required",!0).attr("data-choices",!0)}function showErrorAndGoBack(message){Swal.fire({text:message,icon:"error"}).then(()=>{history.back()})}function showTemporaryAlert(selector,duration){$(selector).show(),setTimeout(()=>{$(selector).fadeOut()},duration)}$(document).ready((function(){initialize()}));