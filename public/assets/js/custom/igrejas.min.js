function handleSearch(){const search=$("#inSearch").val();atualizarTabela(search)}function populateSupervisorSelect(){const $selectSupervisor=$("#selectSupervisor");$selectSupervisor.empty().removeAttr("required"),$.getJSON(`${_baseUrl}api/v1/supervisores/list`).done(data=>{data.forEach(supervisor=>{const option=`<option value="${supervisor.id}">${supervisor.id} - ${supervisor.nome} ${supervisor.sobrenome}</option>`;$selectSupervisor.append(option)}),$selectSupervisor.attr("required",!0).attr("data-choices",!0),new Choices("#selectSupervisor")}).fail(()=>{Swal.fire({title:"Cadastre supervisores antes...",icon:"error",confirmButtonClass:"btn btn-primary w-xs mt-2",buttonsStyling:!1}).then(()=>history.back())})}function exibirMensagem(type,error){const messages=error.messages;let errorMessage="";for(const key in messages)messages.hasOwnProperty(key)&&(errorMessage+=`${messages[key]}\n`);Swal.fire({title:"error"===type?"Erro ao incluir registro":"Mensagem",text:errorMessage,icon:type,confirmButtonClass:"btn btn-primary w-xs mt-2",buttonsStyling:!1})}function atualizarTabela(search="",page=1){const $perfilCards=$("#perfilCards"),$cardResult=$("#cardResult"),$noResult=$(".noresult"),$loadResult=$(".loadResult");$noResult.hide(),$perfilCards.empty(),$cardResult.hide(),$loadResult.show();const url=new URL(`${_baseUrl}api/v1/igrejas`);search&&url.searchParams.append("search",search),url.searchParams.append("page",page),$.getJSON(url).done(data=>{$("#pager").html(data.pager),$("#numResults").html(data.num),0===data.rows.length?($cardResult.hide(),$noResult.show()):($cardResult.show(),$noResult.hide(),data.rows.forEach(row=>{const randomColor=Math.floor(16777215*Math.random()).toString(16);$perfilCards.append(`\n                        <div class="col-xl-3 col-md-4 col-lg-4">\n                            <div class="card shadow-sm h-100">\n                                <div class="card-body text-center">\n                                    <div class="mx-auto avatar-md mb-3">\n                                        <img src="${row.foto}" onerror="this.onerror=null; this.src='https://placehold.co/50/${randomColor}/FFF?text=${row.razao_social.charAt(0)}';" class="img-fluid rounded-circle" style="width: 100%; height: 100%; object-fit: cover;">\n                                    </div>\n                                    <h5 class="card-title mb-1">#${row.id} - ${row.razao_social}</h5>\n                                    <hr>\n                                    <div class="text-start">\n                                        <p class="text-muted mb-2"><strong>Nome Fantasia:</strong> ${row.fantasia}</p>\n                                        <p class="text-muted mb-2"><strong>Gerente:</strong> ${row.nome_gerente} ${row.sobre_gerente}</p>\n                                        <p class="text-muted mb-2 text-primary"><strong>Dia dízimo:</strong> ${row.data_dizimo}</p>\n                                        <p class="text-muted mb-2"><strong>Supervisor:</strong> ${row.nome_supervisor} ${row.sobre_supervisor}</p>\n                                        <p class="text-muted mb-2"><strong>Região:</strong> ${row.regiao}</p>\n                                        <p class="text-muted mb-2"><strong>UF:</strong> ${row.uf}</p>\n                                        <p class="text-muted mb-2"><strong>Cidade:</strong> ${row.cidade}</p>\n                                        <p class="text-muted mb-2"><strong>CNPJ:</strong> ${row.cnpj}</p>\n                                        <p class="text-muted mb-2"><strong>Email:</strong> ${row.email}</p>\n                                        <p class="text-muted mb-2"><strong>Celular:</strong> ${row.celular}</p>\n                                        <p class="text-muted mb-0"><strong>Telefone:</strong> ${row.telefone}</p>\n                                    </div>\n                                </div>\n                                <a href="${_baseUrl}admin/igreja/${row.id}" class="btn text-white bg-primary card-footer">\n                                    <i class="ri-pencil-line"></i> EDITAR\n                                </a>\n                            </div>\n                        </div>\n                    `)})),$loadResult.hide()}).fail((jqXHR,textStatus,errorThrown)=>{console.error("Erro ao carregar os dados:",textStatus,errorThrown)})}function formataCampos(){const maskConfigs=[{selector:".cpf",mask:"000.000.000-00"},{selector:".cep",mask:"00000-000"},{selector:".telFixo",mask:"(00) 0000-0000"},{selector:".celular",mask:"+00 (00) 0 0000-0000"},{selector:".cnpj",mask:"00.000.000/0000-00"}];maskConfigs.forEach(config=>{$(config.selector).mask(config.mask)})}$(document).ready((function(){formataCampos(),atualizarTabela(),populateSupervisorSelect(),$("#inSearchBtn").on("click",handleSearch),$("#inSearch").on("keypress",(function(e){13===e.which&&handleSearch()})),$("#pager").on("click","a",(function(e){e.preventDefault();const href=$(this).attr("href"),urlParams=new URLSearchParams(href),page=urlParams.get("page"),search=urlParams.get("search");isNaN(page)||atualizarTabela(search,page)})),$("#formCad").ajaxForm({beforeSubmit:function(){Swal.fire({title:"Enviando dados!",icon:"info"})},success:function(){atualizarTabela(),$("#formCad")[0].reset(),Swal.fire({title:"Cadastrado!",icon:"success"})},error:function(xhr){const errorMessage=xhr.responseJSON&&xhr.responseJSON.messages?xhr.responseJSON:{messages:{error:"Erro desconhecido."}};exibirMensagem("error",errorMessage)}})}));