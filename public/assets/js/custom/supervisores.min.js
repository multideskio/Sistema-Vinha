let choicesRegioesInstance,choicesGerentesInstance;function initializeMasks(){$(".cpf").mask("000.000.000-00"),$(".cep").mask("00000-000"),$(".telFixo").mask("(00) 0000-0000"),$(".celular").mask("+00 (00) 0 0000-0000")}function configureSearch(){const searchHandler=()=>{const search=$("#inSearch").val();atualizarTabela(search)};$("#inSearchBtn").click(searchHandler),$("#inSearch").keypress((function(e){13===e.which&&searchHandler()}))}function configurePagination(){$("#pager").on("click","a",(function(e){e.preventDefault();const href=$(this).attr("href"),urlParams=new URLSearchParams(href),page=urlParams.get("page"),search=urlParams.get("search");isNaN(page)||atualizarTabela(search,page)}))}function initializeAjaxForm(){$("#formCad").ajaxForm({beforeSubmit:()=>{Swal.fire({html:"Enviando dados!",icon:"info"})},success:(responseText,statusText,xhr,$form)=>{atualizarTabela(),$("#formCad")[0].reset(),listRegioes(),listGerentes(),Swal.fire({html:"Cadastrado!",icon:"success"})},error:xhr=>{const errorMsg=xhr.responseJSON&&xhr.responseJSON.messages?xhr.responseJSON:{messages:{error:"Erro desconhecido."}};exibirMensagem("error",errorMsg)}})}function exibirMensagem(type,error){let errorMessage="";for(const key in error.messages)error.messages.hasOwnProperty(key)&&(errorMessage+=`${error.messages[key]}\n`);Swal.fire({title:"error"===type?"Erro ao incluir registro":"Mensagem",text:errorMessage,icon:type,confirmButtonClass:"btn btn-primary w-xs mt-2",buttonsStyling:!1})}function initializeChoices(selector){return"undefined"!=typeof Choices?new Choices(selector,{allowHTML:!0}):null}function listRegioes(){choicesRegioesInstance&&choicesRegioesInstance.destroy(),$("#selectRegiao").empty().removeAttr("required"),$.getJSON(`${_baseUrl}api/v1/regioes`,{},data=>{data.rows.forEach(regiao=>{$("#selectRegiao").append(`<option value="${regiao.id}">${regiao.id} - ${regiao.nome}</option>`)}),$("#selectRegiao").attr("required",!0).attr("data-choices",!0),choicesRegioesInstance=initializeChoices("#selectRegiao")}).fail(()=>{exibirMensagem("error",{messages:{error:"Cadastre regiões antes de cadastrar um supervisor..."}}),history.back()})}function listGerentes(){choicesGerentesInstance&&choicesGerentesInstance.destroy(),$("#selectGerentes").empty().removeAttr("required"),$.getJSON(`${_baseUrl}api/v1/gerentes/list`,{},data=>{data.forEach(gerente=>{$("#selectGerentes").append(`<option value="${gerente.id}">${gerente.id} - ${gerente.nome} ${gerente.sobrenome}</option>`)}),$("#selectGerentes").attr("required",!0).attr("data-choices",!0),choicesGerentesInstance=initializeChoices("#selectGerentes")}).fail(()=>{exibirMensagem("error",{messages:{error:"Cadastre gerentes antes de cadastrar um supervisor..."}}),history.back()})}function atualizarTabela(search=!1,page=1){$(".noresult").hide(),$("#perfilCards").empty(),$("#cardResult").hide(),$(".loadResult").show();let url=`${_baseUrl}api/v1/supervisores?`;search&&(url+=`search=${search}&`),page&&(url+=`page=${page}`),$.getJSON(url).done(data=>{$("#numResults").html(data.num),$("#pager").html(data.pager),0===data.rows.length?($("#cardResult").hide(),$(".noresult").show()):($("#cardResult").show(),$(".noresult").hide(),data.rows.forEach(row=>{const randomColor=Math.floor(16777215*Math.random()).toString(16);$("#perfilCards").append(`\n                        <div class="col-xl-3">\n                            <div class="card shadow-sm h-100">\n                                <div class="card-body text-center">\n                                    <div class="mx-auto avatar-md mb-3">\n                                        <img src="${row.foto}" onerror="this.onerror=null; this.src='https://placehold.co/50/${randomColor}/FFF?text=${row.nome.charAt(0)}';" class="img-fluid rounded-circle" style="width: 100%; height: 100%; object-fit: cover;">\n                                    </div>\n                                    <h5 class="card-title mb-1">#${row.id} - ${row.nome} ${row.sobrenome}</h5>\n                                    <hr>\n                                    <div class="text-start">\n                                        <p class="text-muted mb-2"><strong>Gerente:</strong> ${row.gerente_nome} ${row.gerente_sobrenome}</p>\n                                        <p class="text-muted mb-2"><strong>Região:</strong> ${row.regiao_nome}</p>\n                                        <p class="text-muted mb-2"><strong>CPF:</strong> ${row.cpf}</p>\n                                        <p class="text-muted mb-2"><strong>Email:</strong> ${row.email}</p>\n                                        <p class="text-muted mb-2"><strong>Celular:</strong> ${row.celular}</p>\n                                        <p class="text-muted mb-0"><strong>Telefone:</strong> ${row.telefone}</p>\n                                    </div>\n                                </div>\n                                <a href="${_baseUrl}admin/supervisor/${row.id}" class="btn text-white bg-primary card-footer">\n                                    <i class="ri-pencil-line"></i> EDITAR\n                                </a>\n                            </div>\n                        </div>\n                    `)})),$(".loadResult").hide()}).fail((jqXHR,textStatus,errorThrown)=>{console.error("Erro ao carregar os dados:",textStatus,errorThrown)})}$(document).ready((function(){initializeMasks(),atualizarTabela(),listRegioes(),listGerentes(),configureSearch(),configurePagination(),initializeAjaxForm()}));