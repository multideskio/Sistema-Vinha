var chartPieBasicColors=["#008FFB","#212529"],options={series:[],chart:{height:200,type:"pie"},labels:["CRÉDITO","PIX"],legend:{position:"bottom"},dataLabels:{dropShadow:{enabled:!1}},colors:chartPieBasicColors},chart=new ApexCharts(document.querySelector("#simple_pie_chart"),options);function applyGrowthRate(elementId,growthRate){const element=$("#"+elementId),iconClass=growthRate.startsWith("-")?"ri-arrow-right-down-line":"ri-arrow-right-up-line",textClass=growthRate.startsWith("-")?"text-danger":"text-success";element.html(`<i class="${iconClass} fs-13 align-middle"></i> ${growthRate}`).removeClass("text-danger text-success").addClass(textClass)}function dividirData(inputString){const partes=inputString.split("até").map(part=>part.trim());if(2===partes.length){const dataInicio=formatarDataParaApi(partes[0]),dataFim=formatarDataParaApi(partes[1]);return{dataInicio:dataInicio,dataFim:dataFim}}return console.log("Formato de entrada inválido."),null}function formatarDataParaApi(data){const[dia,mes,ano]=data.split("/");return`${ano}-${mes}-${dia}`}function statisticas(search=null){var url=`${_baseUrl}api/v1/transacoes/dashboard?`;if(search){var dates=dividirData(search);dates&&(url+=`dateIn=${dates.dataInicio}&dateOut=${dates.dataFim}`)}$.getJSON(url,(function(data,textStatus,jqXHR){$("#mesDash").html(data.mes.valor),$("#dashBoletos").html(data.boletos.valor),$("#dashPix").html(data.pix.valor),$("#dashCredito").html(data.credito.valor),$("#dashDebito").html(data.debito.valor),$("#dashAnual").html(data.totalAnual.valor),$("#dashTotal").html(data.totalGeral.valor),$("#dashUsers").html(data.totalUsers),applyGrowthRate("mesGrowth",data.mes.crescimento),applyGrowthRate("boletosGrowth",data.boletos.crescimento),applyGrowthRate("pixGrowth",data.pix.crescimento),applyGrowthRate("creditoGrowth",data.credito.crescimento),applyGrowthRate("debitoGrowth",data.debito.crescimento),applyGrowthRate("anualGrowth",data.totalAnual.crescimento),applyGrowthRate("totalGrowth",data.totalGeral.crescimento);var creditoValue,pixValue,seriesData=[parseFloat(data.credito.valor.replace("R$","").replace(",",".")),parseFloat(data.pix.valor.replace("R$","").replace(",","."))];chart.updateSeries(seriesData),search&&Swal.fire({text:"Atualizado...",icon:"success"})})).fail(()=>{Swal.fire({html:"Verifique se já configurou as credenciais da CIELO, qualquer dúvida, entre em contato com o suporte (62) 9 8115-4120",icon:"error"})})}function searchDate(){flatpickr("#dateSearch",{locale:"pt",mode:"range",dateFormat:"d/m/Y",maxDate:"today",minDate:(new Date).fp_incr(-365),defaultDate:[(new Date).fp_incr(-30),"today"]})}function search(){$("#inSearchBtn").on("click",(function(e){var search;listaTransacoes($("#inSearch").val())})),$("#inSearch").on("keypress",(function(e){var search;13===e.which&&listaTransacoes($("#inSearch").val())})),$("#pager").on("click","a",(function(e){e.preventDefault();var href=$(this).attr("href"),urlParams=new URLSearchParams(href),page=urlParams.get("page"),search=urlParams.get("search");isNaN(page)||listaTransacoes(search,page)}))}function listaTransacoes(search=!1,page=1){$("#listaTransacoes").empty(),$("#tableTransacoes").hide(),$("#loadResult").show();var url=`${_baseUrl}api/v1/transacoes/lista?`;search&&(url+="search="+encodeURIComponent(search)+"&"),page&&(url+="page="+page),$.getJSON(url,(function(data,textStatus,jqXHR){$("#numResults").html(data.num),$("#pager").html(data.pager),$.each(data.rows,(function(indexInArray,row){let status;status="Pago"===row.status?'<span class="badge bg-success-subtle text-success">Pago</span>':"Cancelado"===row.status?'<span class="badge bg-danger-subtle text-danger">Cancelado</span>':"Reembolsado"===row.status?'<span class="badge bg-dark-subtle text-dark">Reembolsado</span>':'<span class="badge bg-warning-subtle text-warning">Aguardando</span>',$("#listaTransacoes").append(`<tr><th scope="row">${row.id}</th><td>${row.nome}<br><small class="text-muted">${row.email}</small></td><td>${row.valor}</td><td>${status}</td><td>${row.forma_pg}</td><td><a href="${row.url}" class="btn btn-sm btn-soft-dark waves-effect waves-light">ver</a></td></tr>`)})),$("#tableTransacoes").show(),$("#loadResult").hide()}))}function searchUser(){$("#pagerUser").on("click","a",(function(e){e.preventDefault();var href=$(this).attr("href"),urlParams=new URLSearchParams(href),page=urlParams.get("page"),search=urlParams.get("search");isNaN(page)||listaUsuarios(search,page)}))}function listaUsuarios(search=!1,page=1){$("#listaUsuarios").empty(),$("#tableUsers").hide(),$("#loadResultUsers").show();var url=`${_baseUrl}api/v1/usuarios?`;search&&(url+="search="+encodeURIComponent(search)+"&"),page&&(url+="page="+page),$.getJSON(url,(function(data,textStatus,jqXHR){$.each(data.rows,(function(indexInArray,row){$("#listaUsuarios").append(`<tr><th scope="row">${row.id}</th><td>${row.nome}<br><small class="text-muted">${row.email}</small></td><td>${row.tipo}</td><td><a href="${row.url}" class="btn btn-sm btn-soft-dark waves-effect waves-light">ver</a></td></tr>`)})),$("#tableUsers").show(),$("#loadResultUsers").hide(),$("#numResultsUsers").html(data.num),$("#pagerUser").html(data.pager)}))}chart.render(),$(document).ready((function(){statisticas(),listaTransacoes(),search(),listaUsuarios(),searchUser(),searchDate(),$("#btnSearchDash").on("click",(function(){var search=$("#dateSearch").val();search?(Swal.fire({text:"Atualizando painel...",icon:"info"}),statisticas(search),console.log(search)):Swal.fire({text:"Defina uma data para gerar o relatório...",icon:"error"})}))}));