let choicesInstance;function initializeMasks(){$(".cpf").mask("000.000.000-00"),$(".cep").mask("00000-000"),$(".telFixo").mask("(00) 0000-0000"),$(".celular").mask("+00 (00) 0 0000-0000")}function atualizarTabela(search="",page=1){$(".noresult").hide(),$("#perfilCards").empty(),$("#cardResult").hide(),$(".loadResult").show();const url=_baseUrl+"api/v1/pastores?"+$.param({search:search,page:page});$.getJSON(url).done((function(data){renderizarTabela(data)})).fail((function(jqXHR,textStatus,errorThrown){console.error("Erro ao carregar os dados:",textStatus,errorThrown)}))}function renderizarTabela(data){$("#pager").html(data.pager),$("#numResults").html(data.num),0===data.rows.length?($("#cardResult").hide(),$(".noresult").show()):($("#cardResult").show(),$(".noresult").hide(),data.rows.forEach((function(row){const randomColor=Math.floor(16777215*Math.random()).toString(16);$("#perfilCards").append(`\n\t\t\t\t<div class="col-xl-3">\n\t\t\t\t\t<div class="card shadow-sm h-100">\n\t\t\t\t\t\t<div class="card-body text-center">\n\t\t\t\t\t\t\t<div class="mx-auto avatar-md mb-3">\n\t\t\t\t\t\t\t\t<img src="${row.foto}" onerror="this.onerror=null; this.src='https://placehold.co/50/${randomColor}/FFF?text=${row.nome.charAt(0)}';" class="img-fluid rounded-circle" style="width: 100%; height: 100%; object-fit: cover;">\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<h5 class="card-title mb-1">#${row.id} - ${row.nome} ${row.sobrenome}</h5>\n\t\t\t\t\t\t\t<hr>\n\t\t\t\t\t\t\t<div class="text-start">\n\t\t\t\t\t\t\t\t<p class="text-muted mb-2"><strong>Gerente:</strong> ${row.nome_gerente} ${row.sobre_gerente}</p>\n\t\t\t\t\t\t\t\t<p class="text-muted mb-2"><strong>Supervisor:</strong> ${row.nome_supervisor} ${row.sobre_supervisor}</p>\n\t\t\t\t\t\t\t\t<p class="text-muted mb-2"><strong>Regi√£o:</strong> ${row.regiao}</p>\n\t\t\t\t\t\t\t\t<p class="text-muted mb-2"><strong>CPF:</strong> ${row.cpf}</p>\n\t\t\t\t\t\t\t\t<p class="text-muted mb-2"><strong>Email:</strong> ${row.email}</p>\n\t\t\t\t\t\t\t\t<p class="text-muted mb-2"><strong>Celular:</strong> ${row.celular}</p>\n\t\t\t\t\t\t\t\t<p class="text-muted mb-0"><strong>Telefone:</strong> ${row.telefone}</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<a href="${_baseUrl}admin/pastor/${row.id}" class="btn text-white bg-primary card-footer"><i class="ri-pencil-line"></i> DADOS</a>\n\t\t\t\t\t</div>\n\t\t\t\t</div>`)}))),$(".loadResult").hide()}function populateSupervisorSelect(){choicesInstance&&choicesInstance.destroy(),$("#selectSupervisor").empty().removeAttr("required"),$.getJSON(_baseUrl+"api/v1/supervisores/list",{},data=>{data.forEach((function(supervisor){$("#selectSupervisor").append(`<option value="${supervisor.id}">${supervisor.id} - ${supervisor.nome} ${supervisor.sobrenome}</option>`)})),$("#selectSupervisor").attr("required",!0).attr("data-choices",!0),choicesInstance=initializeChoices("#selectSupervisor")}).fail(()=>{exibirMensagem("error",{messages:{error:"Cadastre supervisores antes de cadastrar um supervisor..."}}),history.back()})}function configureSearch(){$("#inSearchBtn").click((function(){const search=$("#inSearch").val();atualizarTabela(search)})),$("#inSearch").keypress((function(e){if(13===e.which){const search=$("#inSearch").val();atualizarTabela(search)}})),$("#pager").on("click","a",(function(e){e.preventDefault();const href=$(this).attr("href"),urlParams=new URLSearchParams(href),page=urlParams.get("page"),search=urlParams.get("search");isNaN(page)||atualizarTabela(search,page)}))}function initializeChoices(selector){return"undefined"!=typeof Choices?new Choices(selector,{allowHTML:!0}):null}function initializeAjaxForm(){$("#formCad").ajaxForm({beforeSubmit:function(){Swal.fire({title:"Enviando dados!",icon:"info"})},success:function(){atualizarTabela(),$("#formCad")[0].reset(),populateSupervisorSelect(),Swal.fire({title:"Cadastrado!",icon:"success",confirmButtonClass:"btn btn-primary w-xs mt-2",buttonsStyling:!1})},error:function(xhr){const errorMessage=xhr.responseJSON&&xhr.responseJSON.messages?xhr.responseJSON:{messages:{error:"Erro desconhecido."}};exibirMensagem("error",errorMessage)}})}function exibirMensagem(type,error){const messages=error.messages;let errorMessage="";for(const key in messages)messages.hasOwnProperty(key)&&(errorMessage+=`${messages[key]}\n`);Swal.fire({title:"error"===type?"Erro ao incluir registro":"Mensagem",text:errorMessage,icon:type,confirmButtonClass:"btn btn-primary w-xs mt-2",buttonsStyling:!1})}function definirDataMaximaNascimento(){const today=new Date,year=today.getFullYear()-18,month=today.getMonth()+1,day=today.getDate(),minDate=`${year}-${month<10?"0"+month:month}-${day<10?"0"+day:day}`;document.getElementById("nascimento").setAttribute("max",minDate)}$(document).ready((function(){initializeMasks(),atualizarTabela(),populateSupervisorSelect(),configureSearch(),initializeAjaxForm()})),document.addEventListener("DOMContentLoaded",(function(){definirDataMaximaNascimento()}));